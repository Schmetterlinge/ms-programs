define int last_light

signal void clkGen()
{	
	for(;;)
	{		
		twatch(20);
		P3 = P3 ^ 0x01;
		
		if (states > 40 && (P3 & ~(0x02)) != P3) {
			printf("Daylight sensor turned off\n");
			P3 = P3 & ~(0x02);
		}
	}
}

func void onLight()
{	
	int light;
	light = P3 & 0x80;
	if(light != last_light)
	{
		if(light)
			printf("@%d: Light: ON", states);
		else
			printf("@%d: Light: OFF", states);
	}
	last_light = light;
}

BK	*
BS WRITE P3, 1, "onLight()"
last_light = P3 & 0x80
clkGen()
